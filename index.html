using System;
using System.Collections.Generic;
using System.IO;
using iTextSharp.text;
using iTextSharp.text.pdf;

namespace BankStatementGenerator
{
    class Program
    {
        static void Main(string[] args)
        {
            // Parse rpt.SH1 file (replace with actual file path)
            var statementData = ParseRptFile("path/to/rpt.SH1");
            
            // Generate PDF
            GeneratePdf(statementData, "BankStatement.pdf");
        }

        static StatementData ParseRptFile(string filePath)
        {
            // Mock data extraction (replace with actual file parsing logic)
            return new StatementData
            {
                ClientBasic = "00001-000068",
                StatementPeriod = "01/10/24-31/10/24",
                CompanyName = "DICKSON CONCEPTS (WHOLESALE) LIMITED",
                Address = "OCEAN CENTRE\n98 GRANVILLE ROAD\nTSIM SHA TSUI HONG KONG",
                AccountNumber = "001-0000-001-0",
                Currency = "HKD",
                OpeningBalance = 46972.84M,
                ClosingBalance = 46972.84M,
                Activities = new List<AccountActivity>
                {
                    new AccountActivity { Date = "01 OCT", Description = "Opening Balance", Balance = 46972.84M },
                    new AccountActivity { Date = "31 OCT", Description = "Closing Balance", Balance = 46972.84M }
                }
            };
        }

        static void GeneratePdf(StatementData data, string outputPath)
        {
            using (FileStream fs = new FileStream(outputPath, FileMode.Create))
            {
                Document doc = new Document(PageSize.A4, 25, 25, 30, 30);
                PdfWriter writer = PdfWriter.GetInstance(doc, fs);

                doc.Open();

                // Title
                doc.Add(new Paragraph("Consolidated Cash Statement", 
                    new Font(Font.FontFamily.HELVETICA, 16, Font.BOLD)) 
                { 
                    Alignment = Element.ALIGN_CENTER,
                    SpacingAfter = 20
                });

                // Client Information
                doc.Add(new Paragraph($"Client Basic: {data.ClientBasic}"));
                doc.Add(new Paragraph($"Statement Period: {data.StatementPeriod}"));
                doc.Add(new Paragraph(data.CompanyName));
                doc.Add(new Paragraph(data.Address));
                doc.Add(Chunk.NEWLINE);

                // Account Summary Table
                PdfPTable summaryTable = new PdfPTable(3);
                summaryTable.WidthPercentage = 100;
                summaryTable.SetWidths(new float[] { 2, 1, 2 });

                summaryTable.AddCell(CreateHeaderCell("Account Number"));
                summaryTable.AddCell(CreateHeaderCell("CCY"));
                summaryTable.AddCell(CreateHeaderCell("Balance"));
                summaryTable.AddCell(CreateCell(data.AccountNumber));
                summaryTable.AddCell(CreateCell(data.Currency));
                summaryTable.AddCell(CreateCell(data.OpeningBalance.ToString("N2")));

                doc.Add(summaryTable);
                doc.Add(Chunk.NEWLINE);

                // Account Activities
                doc.Add(new Paragraph($"CURRENT ACCOUNT {data.AccountNumber} {data.Currency}",
                    new Font(Font.FontFamily.HELVETICA, 12, Font.BOLD)));

                PdfPTable activityTable = new PdfPTable(3);
                activityTable.WidthPercentage = 100;
                activityTable.SetWidths(new float[] { 1, 3, 2 });

                activityTable.AddCell(CreateHeaderCell("Date"));
                activityTable.AddCell(CreateHeaderCell("Transaction Details"));
                activityTable.AddCell(CreateHeaderCell("Balance"));

                foreach (var activity in data.Activities)
                {
                    activityTable.AddCell(CreateCell(activity.Date));
                    activityTable.AddCell(CreateCell(activity.Description));
                    activityTable.AddCell(CreateCell(activity.Balance.ToString("N2")));
                }

                doc.Add(activityTable);
                doc.Add(Chunk.NEWLINE);

                // Important Notice
                doc.Add(new Paragraph("IMPORTANT", 
                    new Font(Font.FontFamily.HELVETICA, 10, Font.BOLD)));
                doc.Add(new Paragraph("THIS STATEMENT WILL BE CONSIDERED CORRECT IF NO ERROR OR OMISSION " +
                    "IS REPORTED TO THE BANK WITHIN 90 DAYS OF STATEMENT POSTING DATE."));
                doc.Add(new Paragraph("For complaints, please call our Client Services section " +
                    "at 2108 5449 or email us at csd_herojemo@eec.sorgevans.com."));

                doc.Close();
            }
        }

        static PdfPCell CreateHeaderCell(string text)
        {
            return new PdfPCell(new Phrase(text, 
                new Font(Font.FontFamily.HELVETICA, 10, Font.BOLD)))
            {
                BackgroundColor = new BaseColor(220, 220, 220),
                Padding = 5,
                HorizontalAlignment = Element.ALIGN_CENTER
            };
        }

        static PdfPCell CreateCell(string text)
        {
            return new PdfPCell(new Phrase(text))
            {
                Padding = 5,
                HorizontalAlignment = Element.ALIGN_LEFT
            };
        }
    }

    // Data Classes
    public class StatementData
    {
        public string ClientBasic { get; set; }
        public string StatementPeriod { get; set; }
        public string CompanyName { get; set; }
        public string Address { get; set; }
        public string AccountNumber { get; set; }
        public string Currency { get; set; }
        public decimal OpeningBalance { get; set; }
        public decimal ClosingBalance { get; set; }
        public List<AccountActivity> Activities { get; set; }
    }

    public class AccountActivity
    {
        public string Date { get; set; }
        public string Description { get; set; }
        public decimal Balance { get; set; }
    }
}
