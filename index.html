using System;
using System.Collections.Generic;
using System.IO;
using iTextSharp.text;
using iTextSharp.text.pdf;

namespace BankStatementGenerator
{
    class Program
    {
        static void Main(string[] args)
        {
            var statementData = ParseRptFile("path/to/rpt.SH1");
            GeneratePdf(statementData, "BankStatement.pdf");
        }

        static StatementData ParseRptFile(string filePath)
        {
            // Implement your actual file parsing logic here
            return new StatementData
            {
                ClientBasic = "00001-000068",
                StatementPeriod = "01/10/24-31/10/24",
                CompanyName = "DICKSON CONCEPTS (WHOLESALE) LIMITED",
                Address = "OCEAN CENTRE\n98 GRANVILLE ROAD\nTSIM SHA TSUI HONG KONG",
                AccountNumber = "001-0000-001-0",
                Currency = "HKD",
                OpeningBalance = 46972.84M,
                ClosingBalance = 46972.84M,
                Activities = new List<AccountActivity>
                {
                    new AccountActivity { Date = "01 OCT", Description = "Opening Balance", Balance = 46972.84M },
                    new AccountActivity { Date = "31 OCT", Description = "Closing Balance", Balance = 46972.84M }
                }
            };
        }

        static void GeneratePdf(StatementData data, string outputPath)
        {
            // Create base Helvetica font
            BaseFont baseFont = BaseFont.CreateFont(
                BaseFont.HELVETICA, 
                BaseFont.CP1252, 
                BaseFont.NOT_EMBEDDED
            );
            
            using (FileStream fs = new FileStream(outputPath, FileMode.Create))
            {
                Document doc = new Document(PageSize.A4, 25, 25, 30, 30);
                PdfWriter writer = PdfWriter.GetInstance(doc, fs);

                doc.Open();

                // Title - using BaseFont directly
                Font titleFont = new Font(baseFont, 16, Font.BOLD);
                doc.Add(new Paragraph("Consolidated Cash Statement", titleFont) 
                { 
                    Alignment = Element.ALIGN_CENTER,
                    SpacingAfter = 20
                });

                // Client Information - using FontFactory
                Font normalFont = FontFactory.GetFont("Helvetica", 12);
                doc.Add(new Paragraph($"Client Basic: {data.ClientBasic}", normalFont));
                doc.Add(new Paragraph($"Statement Period: {data.StatementPeriod}", normalFont));
                doc.Add(new Paragraph(data.CompanyName, normalFont));
                doc.Add(new Paragraph(data.Address, normalFont));
                doc.Add(Chunk.NEWLINE);

                // Account Summary Table
                PdfPTable summaryTable = new PdfPTable(3);
                summaryTable.WidthPercentage = 100;
                summaryTable.SetWidths(new float[] { 2, 1, 2 });

                // Header with background color
                Font headerFont = new Font(baseFont, 10, Font.BOLD);
                summaryTable.AddCell(new PdfPCell(new Phrase("Account Number", headerFont)) 
                { 
                    BackgroundColor = new BaseColor(220, 220, 220),
                    HorizontalAlignment = Element.ALIGN_CENTER,
                    Padding = 5
                });
                summaryTable.AddCell(new PdfPCell(new Phrase("CCY", headerFont)) 
                { 
                    BackgroundColor = new BaseColor(220, 220, 220),
                    HorizontalAlignment = Element.ALIGN_CENTER,
                    Padding = 5
                });
                summaryTable.AddCell(new PdfPCell(new Phrase("Balance", headerFont)) 
                { 
                    BackgroundColor = new BaseColor(220, 220, 220),
                    HorizontalAlignment = Element.ALIGN_CENTER,
                    Padding = 5
                });

                // Data rows
                summaryTable.AddCell(new PdfPCell(new Phrase(data.AccountNumber, normalFont)) 
                { 
                    Padding = 5,
                    HorizontalAlignment = Element.ALIGN_LEFT
                });
                summaryTable.AddCell(new PdfPCell(new Phrase(data.Currency, normalFont)) 
                { 
                    Padding = 5,
                    HorizontalAlignment = Element.ALIGN_LEFT
                });
                summaryTable.AddCell(new PdfPCell(new Phrase(data.OpeningBalance.ToString("N2"), normalFont)) 
                { 
                    Padding = 5,
                    HorizontalAlignment = Element.ALIGN_RIGHT
                });

                doc.Add(summaryTable);
                doc.Add(Chunk.NEWLINE);

                // Account Activities
                Font sectionFont = new Font(baseFont, 12, Font.BOLD);
                doc.Add(new Paragraph($"CURRENT ACCOUNT {data.AccountNumber} {data.Currency}", sectionFont));

                PdfPTable activityTable = new PdfPTable(3);
                activityTable.WidthPercentage = 100;
                activityTable.SetWidths(new float[] { 1, 3, 2 });

                // Header row
                activityTable.AddCell(new PdfPCell(new Phrase("Date", headerFont)) 
                { 
                    BackgroundColor = new BaseColor(220, 220, 220),
                    HorizontalAlignment = Element.ALIGN_CENTER,
                    Padding = 5
                });
                activityTable.AddCell(new PdfPCell(new Phrase("Transaction Details", headerFont)) 
                { 
                    BackgroundColor = new BaseColor(220, 220, 220),
                    HorizontalAlignment = Element.ALIGN_CENTER,
                    Padding = 5
                });
                activityTable.AddCell(new PdfPCell(new Phrase("Balance", headerFont)) 
                { 
                    BackgroundColor = new BaseColor(220, 220, 220),
                    HorizontalAlignment = Element.ALIGN_CENTER,
                    Padding = 5
                });

                // Data rows
                foreach (var activity in data.Activities)
                {
                    activityTable.AddCell(new PdfPCell(new Phrase(activity.Date, normalFont)) 
                    { 
                        Padding = 5
                    });
                    activityTable.AddCell(new PdfPCell(new Phrase(activity.Description, normalFont)) 
                    { 
                        Padding = 5
                    });
                    activityTable.AddCell(new PdfPCell(new Phrase(activity.Balance.ToString("N2"), normalFont)) 
                    { 
                        Padding = 5,
                        HorizontalAlignment = Element.ALIGN_RIGHT
                    });
                }

                doc.Add(activityTable);
                doc.Add(Chunk.NEWLINE);

                // Important Notice
                Font noticeFont = new Font(baseFont, 10, Font.BOLD);
                doc.Add(new Paragraph("IMPORTANT", noticeFont));
                doc.Add(new Paragraph("THIS STATEMENT WILL BE CONSIDERED CORRECT IF NO ERROR OR OMISSION " +
                    "IS REPORTED TO THE BANK WITHIN 90 DAYS OF STATEMENT POSTING DATE.", normalFont));
                doc.Add(new Paragraph("For complaints, please call our Client Services section " +
                    "at 2108 5449 or email us at csd_herojemo@eec.sorgevans.com.", normalFont));

                doc.Close();
            }
        }
    }

    // Data Classes
    public class StatementData
    {
        public string ClientBasic { get; set; }
        public string StatementPeriod { get; set; }
        public string CompanyName { get; set; }
        public string Address { get; set; }
        public string AccountNumber { get; set; }
        public string Currency { get; set; }
        public decimal OpeningBalance { get; set; }
        public decimal ClosingBalance { get; set; }
        public List<AccountActivity> Activities { get; set; }
    }

    public class AccountActivity
    {
        public string Date { get; set; }
        public string Description { get; set; }
        public decimal Balance { get; set; }
    }
}
