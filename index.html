using System;
using System.IO;
using System.Linq;
using System.Text.RegularExpressions;
using System.Collections.Generic;
using iTextSharp.text;
using iTextSharp.text.pdf;

class StatementPDFGenerator
{
    static void Main()
    {
        string inputFile = @"C:\Path\To\Your\File.rpt.SH1";
        string outputFile = @"C:\Path\To\Output\Statement.pdf";

        string[] lines = File.ReadAllLines(inputFile);
        
        string accountNumber = "";
        string currency = "";
        string balance = "";
        string period = "";
        List<string[]> transactions = new();

        // Parse header details and transaction lines
        foreach (string line in lines)
        {
            if (line.Contains("Account:"))
                accountNumber = line.Split(':')[1].Trim();
            else if (line.Contains("Currency:"))
                currency = line.Split(':')[1].Trim();
            else if (line.Contains("Balance:"))
                balance = line.Split(':')[1].Trim();
            else if (line.Contains("Period:"))
                period = line.Split(':')[1].Trim();
            else if (Regex.IsMatch(line, @"^\d{2} \w{3}"))
            {
                // Transaction line (e.g., 01 OCT  Opening Balance     0.00     0.00    46,972.84)
                var parts = Regex.Split(line.Trim(), @"\s{2,}"); // split by 2+ spaces
                if (parts.Length >= 3)
                {
                    string date = parts[0];
                    string detail = parts[1];
                    string deposit = parts.Length > 2 ? parts.ElementAtOrDefault(2) ?? "" : "";
                    string withdrawal = parts.Length > 3 ? parts.ElementAtOrDefault(3) ?? "" : "";
                    string bal = parts.Length > 4 ? parts.ElementAtOrDefault(4) ?? "" : "";
                    transactions.Add(new[] { date, detail, deposit, withdrawal, bal });
                }
            }
        }

        // Generate PDF
        Document doc = new Document(PageSize.A4, 40, 40, 50, 50);
        PdfWriter.GetInstance(doc, new FileStream(outputFile, FileMode.Create));
        doc.Open();

        Font titleFont = FontFactory.GetFont("Arial", 14, Font.BOLD);
        Font boldFont = FontFactory.GetFont("Arial", 10, Font.BOLD);
        Font normalFont = FontFactory.GetFont("Arial", 10, Font.NORMAL);

        doc.Add(new Paragraph("Consolidated Cash Statement", titleFont));
        doc.Add(new Paragraph("\n"));

        // Header Info Table
        PdfPTable info = new PdfPTable(2) { WidthPercentage = 100 };
        info.AddCell(new Phrase("Account Number:", boldFont));
        info.AddCell(new Phrase(accountNumber, normalFont));
        info.AddCell(new Phrase("Statement Period:", boldFont));
        info.AddCell(new Phrase(period, normalFont));
        info.AddCell(new Phrase("Currency:", boldFont));
        info.AddCell(new Phrase(currency, normalFont));
        info.AddCell(new Phrase("Closing Balance:", boldFont));
        info.AddCell(new Phrase(balance, normalFont));
        doc.Add(info);

        doc.Add(new Paragraph("\nACCOUNT ACTIVITIES\n", boldFont));

        // Transactions Table
        PdfPTable txnTable = new PdfPTable(5) { WidthPercentage = 100 };
        txnTable.SetWidths(new float[] { 2, 5, 3, 3, 3 });

        string[] headers = { "Date", "Transaction Details", "Deposit", "Withdrawal", "Balance" };
        foreach (var h in headers)
            txnTable.AddCell(new Phrase(h, boldFont));

        foreach (var row in transactions)
        {
            foreach (string cell in row)
            {
                txnTable.AddCell(new Phrase(cell, normalFont));
            }
        }

        doc.Add(txnTable);

        // Footer
        doc.Add(new Paragraph("\nIMPORTANT: This statement will be considered correct if no error or omission is reported within 90 days of statement posting date.", normalFont));

        doc.Close();
        Console.WriteLine("PDF successfully generated at:\n" + outputFile);
    }
}
            
